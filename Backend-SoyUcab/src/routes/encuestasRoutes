const express = require('express');
const router = express.Router();
const encuestaController = require('../controllers/encuestaController');

console.log('üî•üî•üî• ARCHIVO DE RUTAS CARGADO üî•üî•üî•');

// Middleware que se ejecuta en TODAS las peticiones a /api/encuestas
router.use((req, res, next) => {
    console.log('üöÄüöÄüöÄ ===== MIDDLEWARE ENCUESTAS ===== üöÄüöÄüöÄ');
    console.log('üìç M√©todo:', req.method);
    console.log('üìç Path:', req.path);
    console.log('üìç URL completa:', req.originalUrl);
    console.log('üöÄüöÄüöÄ =============================== üöÄüöÄüöÄ');
    next();
});

// RUTAS ESPEC√çFICAS PRIMERO
router.post('/publicar', encuestaController.publicarEncuesta);
router.get('/check-voto', encuestaController.checkVoto);
router.post('/votar', encuestaController.votarEncuesta);

// ESTA ES LA RUTA IMPORTANTE
router.get('/mis-encuestas/:email', (req, res) => {
    console.log('üî• RUTA /mis-encuestas/:email ALCANZADA');
    console.log('üìß Email recibido:', req.params.email);
    encuestaController.getMisEncuestas(req, res);
});

// RUTAS GENERALES
router.post('/', encuestaController.createEncuesta);
router.get('/', encuestaController.getEncuestas);

// RUTAS CON PAR√ÅMETROS AL FINAL
router.delete('/:tipo_encuesta/:titulo', encuestaController.deleteEncuesta);
router.get('/:tipo_encuesta/:titulo', encuestaController.getEncuestaDetalle);

console.log('‚úÖ Todas las rutas de encuestas registradas');

module.exports = router;